# 08.游戏引擎的动画技术基础(上

![骨骼动画（左）、蒙皮动画（中）、物理仿真（右)](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled.png)

骨骼动画（左）、蒙皮动画（中）、物理仿真（右)

## 动画在游戏中的挑战

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%201.png)

游戏是动的：

- 根据交互的不同而不同；
- 要和其他游戏系统互动；
- 对复杂的环境做出调整。

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%202.png)

实时：

- 计算每帧；
- 动画数据特别大（磁盘和内存）。

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%203.png)

真实：

- 更生动的表情；
- 更真实的体验。

![内容大纲](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%204.png)

内容大纲

## 游戏2D动画技术

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%205.png)

### 精灵动画

![2D精灵动画](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%206.png)

2D精灵动画

优点：

不会破坏背景，直接叠加在上面；

可以设计成无限播放的动画。

![伪3D精灵动画](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%207.png)

伪3D精灵动画

原理：

通过绘制多个视角的动画，然后再不同的视角方向播放不同的精灵动画。

![现代游戏中的精灵动画](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%208.png)

现代游戏中的精灵动画

### Live2D

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%209.png)

优点：

不需要3D模型就能实现2D动画。

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2010.png)

原理：

通过对不同部分惊醒位移、旋转、放缩；再结合实时动画捕捉，就能成为Vtuber！

1. 图元排序
2. 制作控制网格（权重）
3. 设置关键帧帮助制作动画插值（K帧）
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2011.png)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2012.png)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2013.png)
    

## 游戏3D动画技术

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2014.png)

![自由度](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2015.png)

自由度

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2016.png)

刚体在三维空间下只有六个自由度（平移与旋转）

- 分层动画
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2017.png)
    
    最早的3D动画制作方式：
    
    一个角色的刚体模型被一个骨骼物体绑定，这些刚体部分分层的被骨骼约束。
    
    缺点:
    
    穿插。
    
- 顶点动画
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2018.png)
    
    特点：
    
    - 非常灵活；
    - 通过Vertex Animation Texture(VAT)绘制；
    - 适用复杂动画；
    - 需要大量的数据。
- Morgh Target Animation(变形目标动画）
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2019.png)
    
    顶点动画和Key Frame之间进行插值。
    
    案例：
    
    各个游戏中的捏脸系统。
    
- 3D Skinned Animation(3D蒙皮动画）
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2020.png)
    
    特点：
    
    - 网格(或皮肤)被绑定到骨骼的关节上;
    - 每个顶点可以被多个骨骼权重影响。
    
    优点：
    
    - 需要的数据比逐顶点动画更少；
    - Mesh可以以自然的方式进行动画(如人类的“皮肤”)。
- 2D Skinned Animation(2D蒙皮动画)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2021.png)
    
    原子3D蒙皮动画：
    
    - 创建不同的身体部分；
    - 创建身体部分网格并将它们拼接在一起；
    - 骨骼、蒙皮和动画。
- Physics-based Animation（基于物理的动画）
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2022.png)
    
    - 布娃娃系统；
    - 布料和流体模拟；
    - 反向动力学IK.
- Animation Content Creation(创造动画）
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2023.png)
    
    - 手K动画；
    - 动捕。

## 蒙皮动画的实现

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2024.png)

- 如何让一个网格动起来
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2025.png)
    
    1. 制作一个模型；
    2. 为模型制作骨骼；
    3. 刷上蒙皮；
    4. 制作动作所需要的姿势；
    5. 通过骨骼和蒙皮权重制作蒙皮动画。
    
    三个空间/坐标系
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2026.png)
    
    - 世界空间；
    - 模型空间；
    - 局部空间。
- Skeleton for Creatures(骨骼生物)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2027.png)
    
    - 一个关节被选为根骨骼（根目录？
    - 除了根骨骼，一切骨骼都有父级
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2028.png)
    
    - 关节才是动画师实际操作运动的对象；
    - 骨骼只是关节之间的空隙。
    
    骨骼（Bone）是由两个关节（Joint）定义出来的。
    
- 真实游戏中的人类骨骼
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2029.png)
    
    普遍来说50-100个骨骼就够了，但是例如为了制作人脸、眼球、翅膀等动画时，需要大量的添加骨骼。
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2030.png)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2031.png)
    
    真实世界中的人类骨骼中心是在尾椎骨位置。
    
    根节点
    
    - 位于两脚之间；
    - 方便接触地面。
    
    尾椎骨骼
    
    - 是根骨骼的第一子骨骼；
    - 人类上半身和下半身分离。
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2032.png)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2033.png)
    
    链接两个骨骼的绑定点，不仅仅是坐标位置的绑定，而是深度的数据融合。
    
    - 绑定姿势——T-pose、A-pose
        
        ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2034.png)
        
        T-pose是早期的骨骼绑定
        
        缺点：
        
        肩胛位置是被挤压的，在展开与变形动作时精度会不够。
        
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2035.png)
    
    骨骼pose有九个自由度：位置、旋转、放缩。
    

## 3D旋转的数学原理

![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2036.png)

![2D旋转数学公式](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2037.png)

2D旋转数学公式

![3D旋转数学公式](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2038.png)

3D旋转数学公式

- **欧拉角**
    
    旋转公式
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2039.png)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2040.png)
    
    - 欧拉角的缺点
        - 缺点一：不支持交换律；
            
            ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2041.png)
            
            旋转需要严格按照顺序，不支持交换律
            
        - 缺点二：欧拉角的退化情况；
            
            ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2042.png)
            
            Y轴旋转90°之后X和Z共轴了
            
        - 缺点三：两个欧拉角旋转做插值的时候也会出很大的问题；
        - 缺点四：多次旋转的叠加非常难以表达；
        - 缺点五：很难做定轴运算。
            
            ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2043.png)
            
        
        欧拉角的应用：
        
        ![万向锁（云台、陀螺仪、无人机）](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2044.png)
        
        万向锁（云台、陀螺仪、无人机）
        

- **Quaternion四元数**
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2045.png)
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2046.png)
    
    任何一个2D空间下的旋转都可以用一个归一化的**复数**值来表达两个旋转的叠加。$a = sin\theta$       $b = cos\theta$
    
    $$
    c = a+bi\newline i^2 = -1
    $$
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2047.png)
    
    四元数定义了ijk三个虚部，对任何一个空间上的旋转都可以用
    
    $$
    q=a+bi+cj+bk
    $$
    
    来表达。
    
    定义：
    
    $$
    i^2 = j^2 = k^2 = ijk = -1
    $$
    
    配平之后得到：
    
    $$
    ij=k \qquad ij=-k\newline jk = i \qquad kj = -i\newline ki = j \qquad ik=-j
    $$
    
    如果我这个四元数是 normalized 的，或者说是单位的四元数的话，那么它的共轭（conjugate，符号 `*`）就是它的逆。
    
    如果四元素表达的是旋转，它的逆就表示了相反方向的旋转。
    
    ![四元数表达欧拉角](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2048.png)
    
    四元数表达欧拉角
    
    <aside>
    💡 为什么里面的角度都是二分之一 ?
    
    ---
    
    假设用四元数对一个点进行旋转，首先要把这个点的三维坐标变成四元数的形式。把它四元数实部设成 0，然后把它的三个轴上的投影写到三个虚部里面，也就是$bi、ji、dk$。
    
    用四元数在三维空间对点进行旋转时候，实际上是一个表达旋转的四元数$*q*$在前，把上面凑出来的四元数（三维空间中的点，实部为 0 的四元数）夹在中间，然后再把$*q*$的逆放到后面。
    
    </aside>
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2049.png)
    
    - 四元数旋转矩阵：
        
        ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2050.png)
        
        对于一个 normalize 的四元数，它的共轭就是它的逆。四元数的乘法实际上是矩阵运算。
        
        $*q*$ 和 $q^{-1}$ 的连乘就是矩阵的连乘，这时候可以得到一个很有意思的公式。就是说任何一个空间上的数字在 rotation 的时候，实际上算出来就是一个 3 乘 3 的矩阵，这个矩阵因为四元数相乘，有些项就消掉了，我们只需要知道它的 $*xyz*$，这个就是旋转的四元数。
        
        <aside>
        💡 这就意味着我们不需要再去算什么sin、cos了实际上旋转要做的就是乘上这个矩阵，任何一个方向一个角度都可以被旋转起来了。
        
        </aside>
        
        ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2051.png)
        
        当要表达一个反向旋转的时候，我们只要求表达旋转的四元数的逆就可以了。
        
        当有一个旋转$q1$，还有个旋转$q2$，假设想把一个点或者一个向量，按照$q1、q2$两次旋转，应该怎么旋转呢？其实旋转的四元数就是$q1$乘$q2$，公式在这里不展开，但其实可以证明这两个事情是等价的。
        
        假设一个方向$u$要转到方向$v$怎么做?
        
        原理也简单，先定义一个$w$就是它的轴。首先把$u$叉乘$v$,就能通过右手定则找到他们两个向量定义面的法向的方向$w$。
        
        $$
        q=[u \cdot  v + \sqrt[2]{(w \cdot w)+(u \cdot v)^2},w]\newline (||u||=||v||=1)
        $$
        
        定义一个四元数，这个四元数它的实部就是$q=[u \cdot v + \sqrt[2]{(w \cdot w)+(u \cdot v)^2},w]$,
        
        它的虚部就是$*w*$，如果算出来$*xyz*$就放到虚部里面。这个$*q*$本身就能够表达这个从$*u*$向$*v*$的旋转。公式看起来简单，但这里面有很多数学推导，这节课不展开。
        
        <aside>
        💡 做动画系统的时候，也不会把这个公式再证明一遍，基本上这些公式从教科书拿过来就可以直接用。
        
        </aside>
        
        ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2052.png)
        

## Joint Pose

- 旋转
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2053.png)
    
    Orientation，这个词其实跟 Rotation 也很像，但是 Orientation 更难表达，它指空间上的朝向。
    每个 joint 在任何时候都有各种各样的朝向变化。
    
    <aside>
    💡 在大量的动画里面的大量的关节，实际上它的运动都是以旋转为主。如果我们只看它和它的父关节之间的关系，会发现它很多时候不会发生平移，也不会发生放缩，只有旋转。所以旋转的表达是动画的一个最核心的东西。
    
    </aside>
    
- 位置
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2054.png)
    
    位置指的就是空间上的平移。
    两个 Joint 的之间的位置一般不会变。比如父 Joint 定在一个位置的时候，子 Joint 的 position 一般不会变。父骨骼转了之后，子 Joint 相应的也是跟着转。但是在游戏引擎里面这个数值还是有用的。
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2055.png)
    
    比如人的 Pelvis 尾椎骨骼，当这个人蹲在那站起来的时候，Pelvis 的位置 position 就会发生变化。角色的站立和蹲下都是要靠这根 Pelvis 组合顶起来，所以这根骨骼就会有很多的平移的变化。
    在人的表情动画里面也有很多平移变化。
    在一些特殊的机械结构里面，比如说我们要做一个古代的弩箭，这个弩箭它会拉开松起。那这个骨骼实际上也有平移变化。
    
- 放缩
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2056.png)
    
    放缩变化实际上一般时候都不会用，但是在有些场合用的还是蛮多的，比如说在面部表达的时候，要去给它做个大眼睛小眼睛、大鼻头高鼻头。而且沿着 X 轴、 Y 轴、 Z 轴的放缩比例可能都不一样。
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2057.png)
    
    [非统一比例动画](https://docs.unrealengine.com/4.27/zh-CN/AnimatingObjects/SkeletalMeshAnimation/NonUniformScale/)
    
- 仿射矩阵
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2058.png)
    
    可以把 Joint 关节分析成三个元素：旋转、平移、放缩。
    
    任何一四元数，我可以把它展开成一个 3 乘 3 的旋转矩阵，放缩同理。平移也可以再转化成 3 乘 4 的矩阵（Affine Matrix 仿射矩阵）。
    
    仿射矩阵和投影矩阵不太一样，投影矩阵最后算坐标还要做透视除法（除以 *w* ）。但是在骨骼动画里面的仿射矩阵是一个 3 乘 4 的矩阵，不需要最下面 0 那一行，因为它永远是正交投影。
    
- 本地空间和模型空间
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2059.png)
    
    动画一般都会存储在 local space 里面，就是说只会去存相对于它的父亲的变化，为什么呢？因为我们会发现当一个角色在动的时候，很多骨骼其实是没有任何动画的，或者是它只有一点点的旋转。
    
    对于每个骨骼，我们需要知道几个概念：
    
    - 这个关节的父关节是谁？
    - 父关节在 local space 里面长什么样？
    - 这个关节它是在模型坐标系里面应该是什么样子的？
        - 实际上是从它的根节点开始，一个骨骼一个骨骼算下来。
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2060.png)
    
    <aside>
    💡 为什么我们要把这个动画数据全部存到局部坐标系呢？
    
    </aside>
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2061.png)
    
    如果动画数据全部存在模型坐标系，以摆动手小臂作为例子，如果每个关节点在模型坐标下插值，它插出来之后，骨头会一会儿变长、一会儿变大。因为如果模型坐标系下插值的话，你插出来的是一条直线（上图）。
    我们应该对 Joint 的 rotation 进行插值，这样就会看到骨骼是在进行定长的旋转（上上图左边）。
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2062.png)
    
    <aside>
    💡 在 Joint 发生平移、旋转的时候，我们希望的皮肤上的 mesh 也跟着动，这里数学是怎么映射的？
    
    </aside>
    
    ![Untitled](08%20%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80(%E4%B8%8A/Untitled%2063.png)
    
    上图定义了一些符号表达。
    这里定义了一个恒等式，假设一个模型顶点 V 只和一个 Joint  J 绑定，绑定在 Joint J 的模型顶点 V 在 local space 里相对 Joint 的位置是不能变的，无论我们做了什么姿势。上图右上角的图中，点（蓝色 V）和 J 的相对位置，再到 t 这一帧，点（黄色 V）和 J 的相对位置，两个在局部坐标系上投影是严格一致的，不然就不叫绑定了。
    因此关节在动的时候，上面的表皮也会跟着动。上图的矩阵就是最核心的一个矩阵。